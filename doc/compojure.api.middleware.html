<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><title>compojure.api.middleware documentation</title></head><body><header><section class="title"><h1><a href="index.html">Compojure-api Api Documentation</a></h1></section><small>Version: 2.0.0-alpha28</small></header><section class="container"><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compojure</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></div></li><li class="depth-3 branch"><a href="compojure.api.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3"><a href="compojure.api.coercion.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coercion</span></div></a></li><li class="depth-4 branch"><a href="compojure.api.coercion.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-4 branch"><a href="compojure.api.coercion.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-4"><a href="compojure.api.coercion.spec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.common.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.compojure-compat.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compojure-compat</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.exception.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>exception</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.help.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>help</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.main.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>main</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.meta.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>meta</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.methods.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>methods</span></div></a></li><li class="depth-3 branch current"><a href="compojure.api.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.request.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>request</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.resource.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>resource</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.routes.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>routes</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.swagger.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>swagger</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.sweet.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sweet</span></div></a></li><li class="depth-3 branch"><a href="compojure.api.upload.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>upload</span></div></a></li><li class="depth-3"><a href="compojure.api.validator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validator</span></div></a></li></ul></div><section class="namespace-docs" id="content"><h2 class="anchor" id="top">compojure.api.middleware</h2><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-api-middleware"><h3><a href="#var-api-middleware">api-middleware</a></h3><div class="usage"><code>(api-middleware handler)</code><code>(api-middleware handler options)</code></div><div class="doc"><div class="markdown"><p>Opinionated chain of middlewares for web apis. Takes optional options-map.</p>
<h3>Exception handlers</h3>
<p>An error handler is a function of exception, ex-data and request to response.</p>
<p>When defining these options, it is suggested to use alias for the exceptions namespace, e.g. <code>[compojure.api.exception :as ex]</code>.</p>
<p>Default:</p>
<pre><code>{::ex/request-validation  ex/request-validation-handler
 ::ex/request-parsing     ex/request-parsing-handler
 ::ex/response-validation ex/response-validation-handler
 ::ex/default             ex/safe-handler}
</code></pre>
<p>Note: Because the handlers are merged into default handlers map, to disable default handler you need to provide <code>nil</code> value as handler.</p>
<p>Note: To catch Schema errors use <code>{:schema.core/error ex/schema-error-handler}</code>.</p>
<h3>Options</h3>
<ul>
  <li>
    <p><strong>:exceptions</strong> for <em>compojure.api.middleware/wrap-exceptions</em> (nil to unmount it)</p>
    <ul>
      <li><strong>:handlers</strong> Map of error handlers for different exception types, type refers to <code>:type</code> key in ExceptionInfo data.</li>
    </ul>
  </li>
  <li>
  <p><strong>:formats</strong> for Muuntaja middleware. Value can be a valid muuntaja options-map,  a Muuntaja instance or nil (to unmount it). See  <a href="https://github.com/metosin/muuntaja/wiki/Configuration">https://github.com/metosin/muuntaja/wiki/Configuration</a> for details.</p></li>
  <li>
  <p><strong>:middleware</strong> vector of extra middleware to be applied last (just before the handler).</p></li>
  <li>
  <p><strong>:ring-swagger</strong> options for ring-swagger&rsquo;s swagger-json method.  e.g. <code>{:ignore-missing-mappings? true}</code></p></li>
  <li>
  <p><strong>:coercion</strong> A function from request-&gt;type-&gt;coercion-matcher, used  in endpoint coercion for types :body, :string and :response.  Defaults to <code>compojure.api.middleware/default-coercion</code>  Setting value to nil disables all coercion.</p></li>
  <li>
  <p><strong>:components</strong> Components which should be accessible to handlers using  :components restructuring. (If you are using api,  you might want to take look at using wrap-components  middleware manually.). Defaults to nil (middleware not mounted).</p></li>
</ul></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L213">view source</a></div></div><div class="public anchor" id="var-api-middleware-defaults"><h3><a href="#var-api-middleware-defaults">api-middleware-defaults</a></h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L198">view source</a></div></div><div class="public anchor" id="var-api-middleware-options"><h3><a href="#var-api-middleware-options">api-middleware-options</a></h3><div class="usage"><code>(api-middleware-options options)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L209">view source</a></div></div><div class="public anchor" id="var-compose-middleware"><h3><a href="#var-compose-middleware">compose-middleware</a></h3><div class="usage"><code>(compose-middleware middleware)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L163">view source</a></div></div><div class="public anchor" id="var-create-muuntaja"><h3><a href="#var-create-muuntaja">create-muuntaja</a></h3><div class="usage"><code>(create-muuntaja)</code><code>(create-muuntaja muuntaja-or-options)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L128">view source</a></div></div><div class="public anchor" id="var-default-muuntaja-options"><h3><a href="#var-default-muuntaja-options">default-muuntaja-options</a></h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L122">view source</a></div></div><div class="public anchor" id="var-encode.3F"><h3><a href="#var-encode.3F">encode?</a></h3><div class="usage"><code>(encode? _ response)</code></div><div class="doc"><div class="markdown"><p>Returns true if the response body is serializable: body is a collection or response has key :compojure.api.meta/serializable?</p></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L115">view source</a></div></div><div class="public anchor" id="var-get-components"><h3><a href="#var-get-components">get-components</a></h3><div class="usage"><code>(get-components req)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L84">view source</a></div></div><div class="public anchor" id="var-get-swagger-data"><h3><a href="#var-get-swagger-data">get-swagger-data</a></h3><div class="usage"><code>(get-swagger-data request)</code></div><div class="doc"><div class="markdown"><p>Reads and deep-merges top-level swagger-data from request, pushed in by set-swagger-data.</p></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L179">view source</a></div></div><div class="public anchor" id="var-middleware-fn"><h3><a href="#var-middleware-fn">middleware-fn</a></h3><div class="usage"><code>(middleware-fn middleware)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L157">view source</a></div></div><div class="public anchor" id="var-set-swagger-data"><h3><a href="#var-set-swagger-data">set-swagger-data</a></h3><div class="usage"><code>(set-swagger-data request data)</code></div><div class="doc"><div class="markdown"><p>Add extra top-level swagger-data into a request. Data can be read with get-swagger-data.</p></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L173">view source</a></div></div><div class="public anchor" id="var-wrap-coercion"><h3><a href="#var-wrap-coercion">wrap-coercion</a></h3><div class="usage"><code>(wrap-coercion handler coercion)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L104">view source</a></div></div><div class="public anchor" id="var-wrap-components"><h3><a href="#var-wrap-components">wrap-components</a></h3><div class="usage"><code>(wrap-components handler components)</code></div><div class="doc"><div class="markdown"><p>Assoc given components to the request.</p></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L75">view source</a></div></div><div class="public anchor" id="var-wrap-exceptions"><h3><a href="#var-wrap-exceptions">wrap-exceptions</a></h3><div class="usage"><code>(wrap-exceptions handler {:keys [handlers]})</code></div><div class="doc"><div class="markdown"><p>Catches all exceptions and delegates to correct error handler according to :type of Exceptions - <strong>:handlers</strong> - a map from exception type to handler  - <strong>:compojure.api.exception/default</strong> - Handler used when exception type doesn&rsquo;t match other handler,  by default prints stack trace.</p></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L46">view source</a></div></div><div class="public anchor" id="var-wrap-format"><h3><a href="#var-wrap-format">wrap-format</a></h3><div class="usage"><code>(wrap-format handler)</code><code>(wrap-format handler options)</code></div><div class="doc"><div class="markdown"><p>Muuntaja format middleware. Can be safely mounted on top of multiple api</p>
<ul>
  <li><strong>:formats</strong> for Muuntaja middleware. Value can be a valid muuntaja options-map,  a Muuntaja instance or nil (to unmount it). See  <a href="https://github.com/metosin/muuntaja/wiki/Configuration">https://github.com/metosin/muuntaja/wiki/Configuration</a> for details.</li>
</ul></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L301">view source</a></div></div><div class="public anchor" id="var-wrap-inject-data"><h3><a href="#var-wrap-inject-data">wrap-inject-data</a></h3><div class="usage"><code>(wrap-inject-data handler data)</code></div><div class="doc"><div class="markdown"><p>Injects data into the request.</p></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L91">view source</a></div></div><div class="public anchor" id="var-wrap-swagger-data"><h3><a href="#var-wrap-swagger-data">wrap-swagger-data</a></h3><div class="usage"><code>(wrap-swagger-data handler data)</code></div><div class="doc"><div class="markdown"><p>Middleware that adds top level swagger-data into request.</p></div></div><div class="src-link"><a href="http://github.com/metosin/compojure-api/blob/master/src/compojure/api/middleware.clj#L185">view source</a></div></div></section></section></body></html>